<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Consentement client — AllergoZymeProtect</title>
  <meta name="description" content="Page officielle de consentement numérique — protection juridique et reconnaissance des risques alimentaires, allergiques et sanitaires." />

  <style>
    :root {
      --gold: #c9a227;
      --gold-strong: #b68f1e;
      --white: #ffffff;
      --gold-alpha-25: rgba(201,162,39,0.25);
      --gold-alpha-45: rgba(201,162,39,0.45);
      --gold-alpha-70: rgba(201,162,39,0.70);
    }

    * { box-sizing: border-box; }
    html, body { margin: 0; height: 100%; font-family: 'Segoe UI', sans-serif; background: var(--white); color: var(--gold-strong); }

    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 32px;
      border-radius: 24px;
      border: 1px solid var(--gold-alpha-45);
      box-shadow: 0 20px 60px var(--gold-alpha-25);
      background: radial-gradient(circle at 50% 20%, var(--gold-alpha-25), transparent 60%), var(--white);
      animation: fadeIn 1s ease both;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    header { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px; }
    header img { width: 52px; height: 52px; }
    h1 { font-size: 1.8rem; margin: 0; text-align: center; text-shadow: 0 0 12px var(--gold-alpha-45); }

    .text {
      background: linear-gradient(180deg, var(--white), #fffdf5);
      border-radius: 14px;
      border: 1px solid var(--gold-alpha-25);
      box-shadow: 0 0 25px rgba(201,162,39,0.08);
      padding: 22px;
      font-size: 0.97rem;
      color: #704f0b;
      text-align: justify;
      line-height: 1.7;
      margin-bottom: 24px;
    }

    ul { margin-left: 20px; }

    form { display: grid; gap: 16px; margin-top: 10px; }
    label { font-weight: 600; }

    input[type="text"], input[type="email"], input[type="tel"] {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--gold-alpha-45);
      border-radius: 12px;
      font-size: 1rem;
      transition: all .2s ease;
    }

    input:focus {
      outline: none;
      border-color: var(--gold-strong);
      box-shadow: 0 0 10px var(--gold-alpha-25);
    }

    button {
      background: var(--gold-strong);
      color: var(--white);
      border: none;
      padding: 14px;
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
      transition: all .3s ease;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px var(--gold-alpha-45);
    }

    .success {
      margin-top: 20px;
      text-align: center;
      background: rgba(201,162,39,0.1);
      border: 1px solid var(--gold-alpha-45);
      padding: 14px;
      border-radius: 12px;
      font-weight: 600;
      display: none;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.85rem;
      opacity: 0.7;
      line-height: 1.5;
    }

    .highlight {
      font-weight: bold;
      color: var(--gold-strong);
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <img src="assets/logo.png" alt="AllergoZymeProtect">
      <h1>AllergoZymeProtect — Consentement Client</h1>
    </header>

    <div class="text">
      <p><strong>Déclaration officielle de reconnaissance et de décharge de responsabilité.</strong></p>

      <p>
        En validant ce formulaire, je confirme avoir pris connaissance des informations concernant les risques inhérents à toute
        consommation alimentaire. Conformément au règlement (UE) n°1169/2011 relatif à l’information du consommateur sur les denrées
        alimentaires, à l’article L.412-1 du Code de la Consommation, et à l’article 1240 du Code civil, je reconnais avoir été clairement
        informé(e) des possibles risques liés à la nature, la préparation, la composition ou la manipulation des denrées servies dans
        cet établissement.
      </p>

      <p>
        Je reconnais également que le restaurateur a pris toutes les mesures raisonnables de prévention, de contrôle et d’hygiène
        conformément à la réglementation française et européenne en vigueur, notamment :
      </p>

      <ul>
        <li>Application stricte des règles du Paquet Hygiène (CE) n°852/2004 et n°853/2004 relatives à la sécurité sanitaire des aliments.</li>
        <li>Formation des équipes à la prévention des risques allergiques et à la gestion des alertes sanitaires.</li>
        <li>Information transparente sur les allergènes présents ou susceptibles d’être présents dans les plats proposés.</li>
        <li>Tenue d’un registre interne de traçabilité des produits et des fournisseurs.</li>
        <li>Procédures régulières de nettoyage et de contrôle du matériel de restauration.</li>
      </ul>

      <p>
        Je reconnais que malgré ces mesures, certains événements échappant à la maîtrise de l’établissement peuvent survenir.
        En conséquence, je dégage expressément la responsabilité civile et pénale du restaurateur pour tout dommage résultant :
      </p>

      <ul>
        <li>d’une allergie ou d’une réaction physiologique non signalée ou signalée tardivement ;</li>
        <li>d’une erreur ou d’une omission dans la communication de mes antécédents médicaux ou alimentaires ;</li>
        <li>d’une intoxication alimentaire non prouvée comme étant directement imputable à l’établissement ;</li>
        <li>d’un désordre digestif, d’un malaise, d’une interaction médicamenteuse ou d’un effet secondaire individuel ;</li>
        <li>d’un cas fortuit ou d’une contamination externe non prévisible (transport, stockage, livraison) ;</li>
        <li>de tout événement de force majeure (coupure électrique, rupture de chaîne du froid, incident imprévisible) ;</li>
        <li>d’une consommation ou manipulation inappropriée d’un produit après service.</li>
      </ul>

      <p>
        Je reconnais avoir été informé(e) que ce dispositif <strong>AllergoZymeProtect</strong> constitue une solution numérique officielle
        de traçabilité et de preuve de consentement, enregistrant ma validation sous forme électronique, avec l’heure, la date et le
        restaurant concerné. Cette validation vaut signature électronique au sens de l’article 1367 du Code civil.
      </p>

      <p>
        Je reconnais avoir lu et compris l’intégralité de ce document et déclare en toute conscience dégager l’établissement de
        toute responsabilité directe ou indirecte liée à un événement sanitaire ou alimentaire pouvant survenir après ma consommation.
        Je confirme également avoir été informé(e) de mes droits en matière de données personnelles conformément au RGPD (Règlement UE 2016/679).
      </p>
    </div>

    <form id="signature-form">
      <label for="nom">Nom et prénom</label>
      <input type="text" id="nom" name="nom" placeholder="Votre nom complet" required>

      <label for="contact">E-mail ou numéro de téléphone</label>
      <input type="text" id="contact" name="contact" placeholder="E-mail ou téléphone" required>

      <label>
        <input type="checkbox" id="consent" required>
        Je reconnais avoir pris connaissance de l’ensemble des informations ci-dessus et j’accepte sans réserve ces conditions.
      </label>

      <button type="submit">Valider et signer</button>
    </form>

    <div class="success" id="success-message">
      ✅ Consentement enregistré avec succès.<br>
      Votre validation est horodatée et transmise au registre sécurisé AllergoZymeProtect.<br>
      Un message de confirmation vous sera envoyé sous peu.
    </div>
  </div>

  <footer>
    © AllergoZymeProtect — Système certifié de traçabilité et de consentement numérique.<br>
    Règlement (UE) 1169/2011 • Code civil art. 1240 & 1367 • Code consommation L.412-1 • Code santé publique L.1323-1.<br>
    Ce consentement électronique dégage expressément la responsabilité de l’établissement.
  </footer>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://VOTRE_PROJET.supabase.co";
    const SUPABASE_KEY = "VOTRE_CLEF_API";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const form = document.getElementById("signature-form");
    const successMessage = document.getElementById("success-message");

    const params = new URLSearchParams(window.location.search);
    const restaurantId = params.get("restaurant");
    const table = params.get("table") || "Général";

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nom = form.nom.value.trim();
      const contact = form.contact.value.trim();

      if (!nom || !contact) {
        alert("Veuillez remplir tous les champs avant de valider.");
        return;
      }

      const { data, error } = await supabase.from("signatures").insert([
        {
          restaurant_id: restaurantId,
          nom_client: nom,
          emailnumero_client: contact,
          consentement: true
        }
      ]);

      if (error) {
        alert("Erreur lors de l’enregistrement : " + error.message);
      } else {
        form.style.display = "none";
        successMessage.style.display = "block";
      }
    });
  </script>
</body>
</html>
